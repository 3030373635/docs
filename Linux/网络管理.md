---
title: 网络管理
---


# 一、网络查询

## 1.1 ip(替换ifconfig)

## 1.2 ping

```shell
ping
 -t 一直ping
 -l 1000 指定包的大小
 -n ping几次
# 如果ping不同，不代表不在线，可能被防火墙拦了
```

## 1.3 arping

> arping，用来向局域网内的其它主机发送ARP请求的指令，它可以用来测试局域网内的某个IP是否已被使用。
>
> -A：与-U参数类似，但是使用的是ARP REPLY包而非ARP REQUEST包。
> -b：发送以太网广播帧，arping在开始时使用广播地址，在收到回复后使用unicast单播地址。
> -c：发送指定的count个ARP REQUEST包后停止。如果指定了-w参数，则会等待相同数量的ARP REPLY包，直到超时为止。
> -D：重复地址探测模式，用来检测有没有IP地址冲突，如果没有IP冲突则返回0。
> -f：收到第一个响应包后退出。
> -h：显示帮助页。
> -I：用来发送ARP REQUEST包的网络设备的名称。
> -q：quite模式，不显示输出。
> -U：无理由的（强制的）ARP模式去更新别的主机上的ARP CACHE列表中的本机的信息，不需要响应。
> -V：显示arping的版本号。
> -w：指定一个超时时间，单位为秒，arping在到达指定时间后退出，无论期间发送或接收了多少包。在这种情况下，arping在发送完指定的count（-c）个包后并不会停止，而是等待到超时或发送的count个包都进行了回应后才会退出。
>
> -s：设置发送ARP包的IP资源地址，如果为空，则按如下方式处理：
> 1、DAD模式（-D）设置为0.0.0.0；
> 2、Unsolicited模式（-U）设置为目标地址；
> 3、其它方式，从路由表计算。

```shell
例1：查看某个IP的MAC地址
arping 192.168.131.155

例2：查看某个IP的MAC地址，并指定count数量
arping -c 1 192.168.131.155

例3：当有多块网卡的时候，指定特定的设备来发送请求包
arping -i eth1 -c 1 192.168.131.155

例4：查看某个IP是否被不同的MAC地址占用（常用）
arping -D 192.168.131.155

例5：查看某个MAC地址的IP，要在同一子网才查得到
arping -c 1 52:54:00:a1:31:89

例6：确定MAC和IP的对应，确定指定的网卡绑定了指定的IP
arping -c 1  -T 192.168.131.156  00:13:72:f9:ca:60

例7：确定IP和MAC对应，确定指定IP绑在了指定的网卡上
arping -c 1  -t  00:13:72:f9:ca:60 192.168.131.156


例8：有时候，本地查不到某主机，可以通过让网关或别的机器去查。以下几种形式测了下都可以
 arping   -c 1  -S 10.240.160.1 -s 88:5a:92:12:c1:c1  10.240.162.115
 arping   -c 1  -S 10.240.160.1   10.240.162.115
```

## 1.4 ss(替换netstat)

> ss命令用于显示socket状态. 他可以显示PACKET sockets, TCP sockets, UDP sockets, DCCP sockets, RAW sockets, Unix domain sockets等等统计. 它比其他工具展示等多tcp和state信息. 它是一个非常实用、快速、有效的跟踪IP连接和sockets的新工具.SS命令可以提供如下信息：
>
> - 所有的TCP sockets
> - 所有的UDP sockets
> - 所有ssh/ftp/ttp/https持久连接
> - 所有连接到Xserver的本地进程
> - 使用state（例如：connected, synchronized, SYN-RECV, SYN-SENT,TIME-WAIT）、地址、端口过滤
> - 所有的state FIN-WAIT-1 tcpsocket连接以及更多
>
> 很多流行的[Linux](http://www.ttlsa.com/linux/)发行版都支持ss以及很多监控工具使用ss命令.熟悉这个工具有助于您更好的发现与解决系统性能问题.**本人强烈建议使用ss命令替代netstat部分命令,**例如netsat -ant/lnt等.

# 二、网络配置

> 网络配置有两种
>
> - 临时配置：如ifconfig eth0 192.168.1.200 netmask 255.255.255.0
> - 永久配置：修改配置文件

## 2.1 IP地址配置

> 网络配置文件：/etc/sysconfig/network-scripts/ifcfg-网卡名
>
> **IP地址配置完要重启网卡**

### 2.1.1 桥接

> 把物理机的网卡当成交换机用，虚拟机和物理机都接入这个交换机，所以他们的IP都是同一个网段的
>
> 需要与宿主机在同一个网段

静态配置

```shell
/etc/sysconfig/network-scripts/ifcfg-eth0

# Generated by parse-kickstart
DEVICE="eth0"
IPV6INIT="yes"
BOOTPROTO="static"
UUID="e9acf2cc-8a2a-41bb-92e4-d472118f7548"

ONBOOT="yes"
IPADDR="192.168.31.123"
NETMASK="255.255.255.0"
GATEWAY="192.168.31.1"
DNS1="8.8.8.8"    DNS可以在这里配，也可以在/etc/resolv.conf里面配
```

动态配置

```shell
/etc/sysconfig/network-scripts/ifcfg-eth0

# Generated by parse-kickstart
ONBOOT="yes"
BOOTPROTO="dhcp"
```

### 2.1.2 NAT

> 给虚拟机分配内网地址**，如果虚拟机要上网，就会通过物理机的网卡进行转发才能上网。

静态配置

```shell
/etc/sysconfig/network-scripts/ifcfg-eth0
# Generated by parse-kickstart
DEVICE="eth0"
IPV6INIT="yes"
BOOTPROTO="static"
UUID="e9acf2cc-8a2a-41bb-92e4-d472118f7548"
ONBOOT="yes"
IPADDR="192.168.1.4"
NETMASK="255.255.255.0"
GATEWAY="192.168.1.1"
DNS1="192.168.31.1"
```

动态配置

```shell
# Generated by parse-kickstart
DEVICE="eth0"
IPV6INIT="yes"
BOOTPROTO="dhcp"
UUID="e9acf2cc-8a2a-41bb-92e4-d472118f7548"
ONBOOT="yes"
```

### 2.1.3 仅主机

> 仅主机模式就是NAT模式去除了网卡转发，因为虚拟机访问外网需要通过物理机的网卡进行转发，如果设置了仅主机模式，就不会转发了，这样只能物理机和虚拟机自己玩了

## 2.2 网卡

```
systemctl start/stop/restart network   网络管理
service network restart/start/stop     网络管理
ifup/ifdown 网卡名                      网卡管理
```

## 2.3 网关

**查看网关**

```shell
[root@DearMeng ~]# route -n

# Gateway等于0.0.0.0时：代表没网关
# Destination等于0.0.0.0，Genmask等于0.0.0.0时：代表访问任意网段的ip，都走gateway对应的网关

(更推荐)[root@DearMeng ~]# ip route
```

**修改网关**

```
# route add default gw 192.168.1.1 dev eth0

这样就把网关修改为192.168.1.1了，这种修改只是临时的，当你重新启动系统或网卡之后，还是会变回原来的网关。要想永久性修改，就要修改/etc/sysconfig/network 这个文件，
这个文件的主要内容如下（你的文件中没有的项，你可以手动添加）：

# vi  /etc/sysconfig/network

NETWORKING=yes #表示系统是否使用网络，一般设置为yes。如果设为no，则不能使用网络。

HOSTNAME=centos #设置本机的主机名，这里设置的主机名要和/etc/hosts中设置的主机名对应

GATEWAY=192.168.1.1 #设置本机连接的网关的IP地址。

**********上面的文件修改完要重新启动一下网卡才会生效：# service network restart ********
```

## 2.4 DNS

```shell
# NDS解析执行顺序
浏览器  www.lqmblog.com 

1. hosts文件找解析记录
    浏览器会首先在你的机器上，寻找一个hosts文件,这是本地测试dns解析文件

    1.1 windows
        C:\Windows\System32\drivers\etc
    1.2 linux
        /etc/hosts

2. DNS缓存中找解析记录

    如果hosts文件未指定解析记录，浏览器就去机器的dns缓存中寻找解析记录  LDNS（local dns缓存）

3. 网络中的DNS服务器找解析记录

    3.1 linux
        /etc/resolv.conf
    3.2 windows
        网络适配器里面指定好的NDS
# 相关命令
[tom@localhost ~]$ nslookup baidu.com 手工解析域名
```

**1）/etc/hosts**

> 本地dns强制解析的文件,一般用于开发环境下做测试

```
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
39.105.88.131 www.baidu.com     ==> 当我们ping www.baidu.com的时候DNS就会去39.105.88.131去找www.baidu.com的IP地址
```

**2）/etc/resolv.conf**

> DNS解析配置文件，只能配置两条记录，一条主DNS服务器，一条副DNS服务器

```
# Generated by NetworkManager
search localdomain
nameserver 10.211.55.1
nameserver fe80::21c:42ff:fe00:18%eth0

当我们ping IP的时候默认先去/etc/hosts里面查找，如果没有再找/etc/resolv.conf
```

# 三、网络通讯

## 3.1 talk

> 用于在两个用户之间即时交谈，双方可以是同一个主机上的用户，也可以是不同主机上的用户
>
> talk服务需要有xinetd和talkd软件包的支持，并且开启talk服务

## 3.2 write

> 用于在和同一系统上的另外一个用户即时交谈

## 3.3 wall

> 广播消息，发送后同一系统不同终端的用户都能收到

## 3.4 mail
